<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PS4 Auto Bin Loader</title>
<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
    padding: 20px;
    color: #fff;
}
.container {
    max-width: 600px;
    margin: auto;
    background: rgba(0,0,0,0.85);
    padding: 20px;
    border-radius: 12px;
}
h1 { text-align:center; color:#2ecc71; }
input, button { padding: 10px; margin-top:10px; width:100%; font-size:16px; }
.logs { margin-top:20px; background:#111; padding:10px; font-family: monospace; max-height:200px; overflow-y:auto; }
.progress-bar { width:100%; height:20px; background:#333; border-radius:10px; overflow:hidden; margin-top:10px;}
.progress { height:100%; width:0%; background:#2ecc71;}
</style>
</head>
<body>
<div class="container">
    <h1>PS4 Auto Bin Loader</h1>
    
    <div>
        <label>Fallback PS4 IP (if auto fails):</label>
        <input type="text" id="ps4-ip" placeholder="192.168.x.x">
    </div>

    <button id="send-btn">Send Payload</button>

    <div class="progress-bar"><div class="progress" id="progress"></div></div>
    <div class="logs" id="logs">Logs will appear here...</div>
</div>

<script>
const BIN_URL = "https://raw.githubusercontent.com/MohRajab7/ps4-payloader-test/refs/heads/main/bins/disable-updates.bin"; // change to your bin path
const DEFAULT_PORT = 9090;

const logs = document.getElementById("logs");
const progress = document.getElementById("progress");
const ipInput = document.getElementById("ps4-ip");
const sendBtn = document.getElementById("send-btn");

function log(msg) {
    logs.innerHTML += msg + "<br>";
    logs.scrollTop = logs.scrollHeight;
}

async function fetchBin() {
    log(`Fetching payload: disable-updates ...`);
    const response = await fetch(BIN_URL);
    if (!response.ok) throw new Error("Failed to fetch payload");
    const arrayBuffer = await response.arrayBuffer();
    log(`Payload loaded (${arrayBuffer.byteLength} bytes)`);
    return new Uint8Array(arrayBuffer);
}

async function sendToPS4(uint8array, ip) {
    const url = `http://${ip}:${DEFAULT_PORT}/`;
    log(`Sending payload to ${url} ...`);

    // send using fetch POST
    const blob = new Blob([uint8array]);
    try {
        const resp = await fetch(url, {
            method: "POST",
            body: blob
        });
        if (resp.ok) {
            log("✅ Payload sent successfully!");
            progress.style.width = "100%";
        } else {
            log(`❌ Failed to send payload: ${resp.status}`);
        }
    } catch(e) {
        log(`❌ Error sending payload: ${e}`);
    }
}

async function main() {
    sendBtn.disabled = true;
    let ps4Ip = "127.0.0.1"; // default to localhost
    if(ipInput.value) ps4Ip = ipInput.value;

    try {
        const payload = await fetchBin();
        await sendToPS4(payload, ps4Ip);
    } catch(e) {
        log("❌ Error: " + e);
    } finally {
        sendBtn.disabled = false;
    }
}

sendBtn.addEventListener("click", main);

// Optionally auto-trigger on page load
// window.addEventListener("load", main);
</script>
</body>
</html>
